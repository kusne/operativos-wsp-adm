<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Restablecer contraseña</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h3>Restablecer contraseña</h3>

  <input id="p1" type="password" placeholder="Nueva contraseña">
  <input id="p2" type="password" placeholder="Repetir contraseña">

  <button id="btn">Guardar</button>
  <p id="msg"></p>

  <script>
    const SUPABASE_URL = "https://ugeydxozfewzhldjbkat.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_ZeLC2rOxhhUXlQdvJ28JkA_qf802-pX";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.getElementById("btn").onclick = async () => {
      const p1 = p1.value;
      const p2 = p2.value;
      if (!p1 || p1 !== p2) {
        msg.textContent = "Las contraseñas no coinciden";
        return;
      }

      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        msg.textContent = "Sesión inválida. Abrí de nuevo el link del mail.";
        return;
      }

      const { error } = await supabase.auth.updateUser({ password: p1 });
      msg.textContent = error ? error.message : "Contraseña actualizada. Ya podés volver a ADM.";
    };
  </script>
</body>
</html>
