<script>
  const SUPABASE_URL = "https://ugeydxozfewzhldjbkat.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_ZeLC2rOxhhUXlQdvJ28JkA_qf802-pX";
  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  const msg = document.getElementById("msg");

  // 1️⃣ Convertir token del mail en sesión
  (async () => {
    const { error } = await supabase.auth.exchangeCodeForSession(
      window.location.href
    );
    if (error) {
      msg.textContent = "Error de sesión. Abrí nuevamente el link del mail.";
    }
  })();

  // 2️⃣ Guardar nueva contraseña
  document.getElementById("btn").onclick = async () => {
    const p1 = document.getElementById("p1").value;
    const p2 = document.getElementById("p2").value;

    if (!p1 || p1 !== p2) {
      msg.textContent = "Las contraseñas no coinciden";
      return;
    }

    const { error } = await supabase.auth.updateUser({
      password: p1
    });

    if (error) {
      msg.textContent = error.message;
    } else {
      msg.textContent = "Contraseña actualizada. Ya podés volver al ADM.";
    }
  };
</script>

